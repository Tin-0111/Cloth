<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>패션쇼 추천 도우미</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  .card-inputs { display: flex; gap: 8px; margin-bottom: 12px; }
  .card { display: flex; flex-direction: column; align-items: center; }
  .controls { margin-bottom: 12px; }
  .results { margin-top: 20px; }
  table { border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 4px 8px; text-align: center; }
  th { background: #f0f0f0; }
</style>
</head>
<body>

<h2>패션쇼 추천 도우미</h2>

<div class="card-inputs" id="cardInputs"></div>

<div class="controls">
  <button id="calcBtn">계산하기</button>
  <label style="margin-left:8px;">
    현재 목표:
    <select id="targetRank">
      <option value="0">조합 없음</option>
      <option value="1">원페어</option>
      <option value="2">투페어</option>
      <option value="3" selected>트리플</option>
      <option value="4">스트레이트</option>
      <option value="5">풀하우스</option>
      <option value="6">포카드</option>
      <option value="7">플러시</option>
      <option value="8">스트레이트 플러시</option>
      <option value="9">파이브카드</option>
    </select>
  </label>
</div>

<div class="results" id="results"></div>

<script>
const CHARS = ['A','B','C','D','E','F','G']; // 7종
const NUMS = [1,2,3,4,5]; // 5종

const RANKS = [
  "조합 없음",
  "원페어",
  "투페어",
  "트리플",
  "스트레이트",
  "풀하우스",
  "포카드",
  "플러시",
  "스트레이트 플러시",
  "파이브카드"
];

// 카드 입력 UI 생성
const cardInputs = document.getElementById('cardInputs');
const cards = [];
for(let i=0; i<5; i++){
  const div = document.createElement('div');
  div.className = 'card';
  const selC = document.createElement('select');
  CHARS.forEach(c=>{
    const opt=document.createElement('option');
    opt.value=c; opt.textContent=c;
    selC.appendChild(opt);
  });
  const selN = document.createElement('select');
  NUMS.forEach(n=>{
    const opt=document.createElement('option');
    opt.value=n; opt.textContent=n;
    selN.appendChild(opt);
  });
  div.appendChild(selC);
  div.appendChild(selN);
  cardInputs.appendChild(div);
  cards.push({cSel: selC, nSel: selN});
}

// 핸드 평가 함수
function evaluateHand(hand){
  const countsNum={}, countsChar={};
  const nums = hand.map(c=>c.n).sort((a,b)=>a-b);
  const chars = hand.map(c=>c.c);
  nums.forEach(n=>countsNum[n]=(countsNum[n]||0)+1);
  chars.forEach(ch=>countsChar[ch]=(countsChar[ch]||0)+1);
  const isFlush = Object.keys(countsChar).length === 1;
  const isStraight = nums.every((n,i)=> i===0 || n===nums[0]+i);
  const vals = Object.values(countsNum).sort((a,b)=>b-a);
  if(vals[0]===5) return {value:9, name:"파이브카드"};
  if(isFlush && isStraight) return {value:8, name:"스트레이트 플러시"};
  if(vals[0]===4) return {value:6, name:"포카드"};
  if(vals[0]===3 && vals[1]===2) return {value:5, name:"풀하우스"};
  if(isFlush) return {value:7, name:"플러시"};
  if(isStraight) return {value:4, name:"스트레이트"};
  if(vals[0]===3) return {value:3, name:"트리플"};
  if(vals[0]===2 && vals[1]===2) return {value:2, name:"투페어"};
  if(vals[0]===2) return {value:1, name:"원페어"};
  return {value:0, name:"조합 없음"};
}

// 특정 족보 "정확히" 확률 계산
function computeExactProbIfReplace(index, targetValue){
  let success=0;
  const total = CHARS.length * NUMS.length;
  for(const c of CHARS){
    for(const n of NUMS){
      const newHand = cards.map((x,i)=>
        i===index ? {c, n:parseInt(n)} : {c:x.cSel.value, n:parseInt(x.nSel.value)}
      );
      const rank = evaluateHand(newHand);
      if(rank.value === targetValue) success++;
    }
  }
  return {success, total, prob: success/total};
}

// 모든 카드 위치에 대해 계산
function calculateAllForRank(targetValue){
  const results = [];
  for(let i=0;i<5;i++){
    results.push({index:i, ...computeExactProbIfReplace(i, targetValue)});
  }
  return results;
}

// 결과 표시
function showResults(startValue){
  const container = document.getElementById('results');
  container.innerHTML = "";
  for(let v=startValue; v<=9; v++){
    const results = calculateAllForRank(v);
    const table = document.createElement('table');
    const caption = document.createElement('caption');
    caption.textContent = `${RANKS[v]} 확률`;
    table.appendChild(caption);
    table.innerHTML += "<tr><th>카드 위치</th><th>성공</th><th>전체</th><th>확률</th></tr>";
    results.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.index+1}</td><td>${r.success}</td><td>${r.total}</td><td>${(r.prob*100).toFixed(2)}%</td>`;
      table.appendChild(tr);
    });
    container.appendChild(table);
  }
}

// 이벤트
document.getElementById('calcBtn').addEventListener('click', ()=>{
  const minValue = parseInt(document.getElementById('targetRank').value,10);
  showResults(minValue);
});
</script>
</body>
</html>
