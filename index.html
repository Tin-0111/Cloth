<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>카드 조합 확률 계산기</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  .controls { margin-bottom: 10px; }
  .cards { display: flex; gap: 5px; margin-bottom: 10px; }
  .card { display: flex; flex-direction: column; align-items: center; border: 1px solid #ccc; padding: 5px; width: 80px; }
  select { width: 70px; }
  table { border-collapse: collapse; margin-bottom: 20px; width: 100%; }
  th, td { border: 1px solid #aaa; padding: 4px; text-align: center; }
  th { background: #eee; }
  .best { background: #ff0; }
</style>
</head>
<body>
<h1>카드 교체 확률 계산기</h1>

<div class="controls">
  <button id="calcBtn">계산하기</button>
  <button id="resetBtn">초기화(예제값)</button>
  <label style="margin-left:8px;">
    현재 목표:
    <select id="targetRank">
      <option value="0">조합 없음</option>
      <option value="1">원페어</option>
      <option value="2">투페어</option>
      <option value="3" selected>트리플</option>
      <option value="4">스트레이트</option>
      <option value="5">풀하우스</option>
      <option value="6">포카드</option>
      <option value="7">플러시</option>
      <option value="8">스트레이트 플러시</option>
      <option value="9">파이브카드</option>
    </select>
  </label>
</div>

<div class="cards" id="cardsContainer"></div>
<div id="results"></div>

<script>
const CHARS = ["하", "꽃", "초", "동", "피"];
const NUMS = ["1", "2", "3", "4", "5", "6", "7"];

let cards = [
  { c: "하", n: "1" },
  { c: "하", n: "2" },
  { c: "꽃", n: "1" },
  { c: "초", n: "1" },
  { c: "피", n: "1" }
];

// 족보 판정
function evaluateHand(hand) {
  const nums = hand.map(c => parseInt(c.n));
  const chars = hand.map(c => c.c);
  const numCounts = {};
  nums.forEach(n => numCounts[n] = (numCounts[n] || 0) + 1);
  const counts = Object.values(numCounts).sort((a,b) => b-a);
  const charCounts = {};
  chars.forEach(c => charCounts[c] = (charCounts[c] || 0) + 1);

  const isFlush = Object.keys(charCounts).length === 1;
  const sortedNums = [...new Set(nums)].sort((a,b) => a-b);
  const isStraight = sortedNums.length === 5 && sortedNums[4]-sortedNums[0] === 4;

  let value = 0, name = "조합 없음";
  if (counts[0] === 5) { value=9; name="파이브카드"; }
  else if (isStraight && isFlush) { value=8; name="스트레이트 플러시"; }
  else if (counts[0] === 4) { value=6; name="포카드"; }
  else if (counts[0] === 3 && counts[1] === 2) { value=5; name="풀하우스"; }
  else if (isFlush) { value=7; name="플러시"; }
  else if (isStraight) { value=4; name="스트레이트"; }
  else if (counts[0] === 3) { value=3; name="트리플"; }
  else if (counts[0] === 2 && counts[1] === 2) { value=2; name="투페어"; }
  else if (counts[0] === 2) { value=1; name="원페어"; }

  return { value, name };
}

function createCardSelectors() {
  const cont = document.getElementById("cardsContainer");
  cont.innerHTML = "";
  cards.forEach((card, i) => {
    const div = document.createElement("div");
    div.className = "card";

    const selC = document.createElement("select");
    CHARS.forEach(ch => {
      const opt = document.createElement("option");
      opt.value = ch; opt.textContent = ch;
      if (card.c === ch) opt.selected = true;
      selC.appendChild(opt);
    });
    selC.addEventListener("change", e => { cards[i].c = e.target.value; });

    const selN = document.createElement("select");
    NUMS.forEach(num => {
      const opt = document.createElement("option");
      opt.value = num; opt.textContent = num;
      if (card.n === num) opt.selected = true;
      selN.appendChild(opt);
    });
    selN.addEventListener("change", e => { cards[i].n = e.target.value; });

    div.appendChild(selC);
    div.appendChild(selN);
    cont.appendChild(div);
  });
}

function computeExactProb(index, targetValue) {
  let success = 0;
  const total = CHARS.length * NUMS.length;
  for (const c of CHARS) {
    for (const n of NUMS) {
      const newHand = cards.map((x, i) => i === index ? { c, n } : { c: x.c, n: x.n });
      const rank = evaluateHand(newHand);
      if (rank.value === targetValue) success++;
    }
  }
  return { success, total, prob: success / total };
}

function calculateAllExact(targetValue) {
  const results = cards.map((_, i) => {
    return { ...computeExactProb(i, targetValue), index: i };
  });
  const best = Math.max(...results.map(r => r.prob));
  return { results, best };
}

function showResultsForRank(rankValue, rankName) {
  const calc = calculateAllExact(rankValue);
  const tbl = document.createElement("table");
  const cap = document.createElement("caption");
  cap.textContent = `${rankName} 확률`;
  tbl.appendChild(cap);
  tbl.innerHTML += `<tr><th>카드 위치</th><th>성공 수</th><th>전체 경우</th><th>확률</th></tr>`;
  calc.results.forEach(r => {
    const tr = document.createElement("tr");
    if (r.prob === calc.best && r.success > 0) tr.classList.add("best");
    tr.innerHTML = `<td>${r.index+1}</td><td>${r.success}</td><td>${r.total}</td><td>${(r.prob*100).toFixed(2)}%</td>`;
    tbl.appendChild(tr);
  });
  document.getElementById("results").appendChild(tbl);
}

document.getElementById("calcBtn").addEventListener("click", () => {
  const minValue = parseInt(document.getElementById("targetRank").value, 10);
  document.getElementById("results").innerHTML = "";
  for (let v = minValue; v <= 9; v++) {
    const tmpHandName = evaluateHand([
      {c:"하",n:"1"},{c:"하",n:"1"},{c:"하",n:"1"},{c:"하",n:"1"},{c:"하",n:"1"}
    ]);
    // 이름 얻기 위해 value만 교체
    const rankNames = ["조합 없음","원페어","투페어","트리플","스트레이트","풀하우스","포카드","플러시","스트레이트 플러시","파이브카드"];
    showResultsForRank(v, rankNames[v]);
  }
});

document.getElementById("resetBtn").addEventListener("click", () => {
  cards = [
    { c: "하", n: "1" },
    { c: "하", n: "2" },
    { c: "꽃", n: "1" },
    { c: "초", n: "1" },
    { c: "피", n: "1" }
  ];
  createCardSelectors();
  document.getElementById("results").innerHTML = "";
});

createCardSelectors();
</script>
</body>
</html>
